## 攻略チートシートについて

* このチートシートはテーマを絞ってガイドする「攻略本」的なものです。

## たぬえさ3と連動する

!!! Info "このページでできること"
    - ゆかコネNEOとたぬえさ3をWebSocketで連携させ、登録ボタンを呼び出します。
    - 既知の不具合を回避しながら安定運用するためのポイントを整理しています。

### 1. 事前準備

!!! Info "前提条件"
    - ゆかコネNEO v2.2.49 以降を推奨（未満のバージョンで運用する場合は後述の対処が必要）
    - たぬえさ3を起動し、WebSocket待ち受けポートを確認できること（既定値は 56543）
    - ゆかコネNEOのWebSocketコール機能を有効化できること

* たぬえさ3側で呼び出したい「登録済みボタン（トリガー）」をあらかじめ作成しておきます。
* ポート番号を変更している場合は、後続の設定で同じ番号を指定してください。

### 2. たぬえさ3側の設定を確認する

1. たぬえさ3を起動し、設定画面からWebSocket受信を許可しているか確認します。
1. ポート番号が `56543` 以外の場合は、メモしておき後ほどゆかコネ側に同じ番号を指定します。
1. 呼び出したい動作を「登録済みボタン」として命名し、名前を控えておきます。

!!! Tips "命名のコツ"
    - 後で設定するJSON内で名前を指定します。全角・半角を誤ると呼び出せないため、コピー&ペーストを推奨します。

### 3. ゆかコネNEOでWebSocketコールを設定する

1. ゆかコネNEOのオプションから「WebSocketコール」プラグインをONにします。
1. 任意の起動フレーズを設定し、コールURLに `ws://localhost:56543` を入力します。ポート番号を変更している場合は同じ番号に置き換えます。
1. 送信文字に次のJSONを入力し、`登録済みボタンの名前` をたぬえさ3側のトリガー名に置き換えます。

```json
{"Type":"Command", "CommandName":"登録済みボタンの名前"}
```

1. 設定を保存し、起動フレーズを発話またはボタンで実行します。

### 4. コマンドを複数登録する

* 複数のボタンを操作したい場合は、起動フレーズと送信文字を組み合わせて複数パターンを登録します。
* JSONの `CommandName` を切り替えることで、任意の登録ボタンを選択できます。

| 目的 | 送信文字の例 |
|:--|:--|
| ボタンAを呼び出す | `{"Type":"Command", "CommandName":"ボタンA"}` |
| ボタンBを呼び出す | `{"Type":"Command", "CommandName":"ボタンB"}` |
| 停止コマンドを送る | `{"Type":"Command", "CommandName":"停止"}` |

### 5. 動作確認のポイント

1. ゆかコネNEOで設定した起動フレーズを送信・実行し、たぬえさ3のログまたはUI上で反応することを確認します。
1. 応答がない場合は、ポート番号・起動フレーズ・CommandNameを見直します。
1. ファイアウォールでWebSocket通信が遮断されていないかを確認します。

### 6. 既知の不具合と回避策

!!! Info "アップデート推奨"
    - ゆかコネ v2.2.49 より前ではファイル処理上の問題があります。アップデートを推奨します。

### 7. トラブルシューティング

* **反応しない場合**: ゆかコネのログで送信可否を確認し、WebSocketコールが許可されているかチェックします。
* **間違ったボタンが反応する**: たぬえさ3側のトリガー名が重複していないか見直します。
* **遅延が大きい**: たぬえさ3側で処理負荷が高いと遅延が発生します。不要な他連携を停止して検証します。
* **他ツールと併用する場合**: WebSocketポートが競合していないか確認し、必要に応じてポート番号を変更します。
